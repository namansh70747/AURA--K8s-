# AURA K8s Helm Chart Values - Production Configuration

# Global settings
global:
  namespace: aura-system
  labels:
    app: aura-k8s
    version: "2.0.0"

# TimescaleDB Configuration
timescaledb:
  enabled: true
  image:
    repository: timescale/timescaledb
    tag: latest-pg15
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "2Gi"
      cpu: "1000m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

  persistence:
    enabled: true
    size: 50Gi
    storageClass: standard

  database:
    name: aura_metrics
    user: aura
    password: aura_password # Change in production!

  service:
    type: ClusterIP
    port: 5432

  nodeSelector:
    workload-type: database

# Collector Service Configuration
collector:
  enabled: true
  replicas: 2

  image:
    repository: aura-collector
    tag: "2.0.0"
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  interval: 15s

  serviceAccount:
    create: true
    name: aura-collector

# ML Service Configuration
mlService:
  enabled: true
  replicas: 1

  image:
    repository: aura-ml-service
    tag: "2.0.0"
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "2Gi"
      cpu: "1000m"
    limits:
      memory: "8Gi"
      cpu: "4000m"

  models:
    path: /models
    ensemble: true
    deepLearning: true
    timeSeries: true

  persistence:
    enabled: true
    size: 10Gi
    storageClass: standard

  nodeSelector:
    workload-type: ml

# MCP Server Configuration
mcpServer:
  enabled: true
  replicas: 2

  image:
    repository: aura-mcp-server
    tag: "2.0.0"
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

  ollama:
    enabled: true
    model: llama2:13b
    fallbackModel: llama2:7b
    url: http://ollama:11434

  service:
    type: NodePort
    port: 8000
    nodePort: 30001

# Ollama Configuration
ollama:
  enabled: true
  replicas: 1

  image:
    repository: ollama/ollama
    tag: latest
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "8Gi"
      cpu: "2000m"
    limits:
      memory: "16Gi"
      cpu: "4000m"

  persistence:
    enabled: true
    size: 50Gi
    storageClass: standard

  service:
    type: ClusterIP
    port: 11434

# Remediator Service Configuration
remediator:
  enabled: true
  replicas: 1

  image:
    repository: aura-remediator
    tag: "2.0.0"
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  interval: 30s
  dryRun: false # Set to true to test without actual remediation

  serviceAccount:
    create: true
    name: aura-remediator

  rbac:
    create: true
    rules:
      - apiGroups: [""]
        resources: ["pods", "pods/log"]
        verbs: ["get", "list", "watch", "delete"]
      - apiGroups: [""]
        resources: ["nodes"]
        verbs: ["get", "list", "watch"]
      - apiGroups: ["apps"]
        resources: ["deployments", "replicasets"]
        verbs: ["get", "list", "watch", "patch"]

# Grafana Configuration
grafana:
  enabled: true
  replicas: 1

  image:
    repository: grafana/grafana
    tag: latest
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"

  admin:
    user: admin
    password: admin # Change in production!

  dashboards:
    enabled: true
    path: /etc/grafana/provisioning/dashboards

  datasources:
    - name: TimescaleDB
      type: postgres
      url: timescaledb:5432
      database: aura_metrics
      user: aura
      password: aura_password
      jsonData:
        sslmode: disable
        timescaledb: true

  service:
    type: NodePort
    port: 3000
    nodePort: 30000

  persistence:
    enabled: true
    size: 5Gi
    storageClass: standard

  nodeSelector:
    workload-type: monitoring

# Autoscaling Configuration
autoscaling:
  collector:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  mcpServer:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 75

# Monitoring & Alerts
monitoring:
  enabled: true

  prometheus:
    enabled: true
    serviceMonitor: true

  alerts:
    enabled: true
    rules:
      - alert: HighAnomalyRate
        expr: anomaly_detection_rate > 0.1
        for: 5m
        severity: warning

      - alert: MLModelDegraded
        expr: ml_model_accuracy < 0.90
        for: 10m
        severity: critical

      - alert: RemediationFailure
        expr: remediation_failure_rate > 0.2
        for: 5m
        severity: critical

# Security
security:
  podSecurityPolicy:
    enabled: true

  networkPolicies:
    enabled: true

  rbac:
    create: true

# Ingress Configuration
ingress:
  enabled: false
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod

  hosts:
    - host: aura.example.com
      paths:
        - path: /
          pathType: Prefix
          service: mcp-server
        - path: /grafana
          pathType: Prefix
          service: grafana

  tls:
    - secretName: aura-tls
      hosts:
        - aura.example.com
